$(document).ready(function(){$("#optgroup").multiSelect({selectableOptgroup:!0,selectableHeader:"<input type='text' class='search-input p-1' style='width: 100%;border-top: 1px solid #ccc;border-left: 1px solid #ccc;border-right: 1px solid #ccc;border-bottom: none;border-radius: 2px;' autocomplete='off' placeholder='Searching...'>",selectionHeader:"<input type='text' class='search-input p-1' style='width: 100%;border-top: 1px solid #ccc;border-left: 1px solid #ccc;border-right: 1px solid #ccc;border-bottom: none;border-radius: 2px;'autocomplete='off' placeholder='Searching...'>",afterInit:function(ms){var that=this,$selectableSearch=that.$selectableUl.prev(),$selectionSearch=that.$selectionUl.prev(),selectableSearchString="#"+that.$container.attr("id")+" .ms-elem-selectable:not(.ms-selected)",selectionSearchString="#"+that.$container.attr("id")+" .ms-elem-selection.ms-selected";that.qs1=$selectableSearch.quicksearch(selectableSearchString).on("keydown",function(e){if(40===e.which)return that.$selectableUl.focus(),!1}),that.qs2=$selectionSearch.quicksearch(selectionSearchString).on("keydown",function(e){if(40==e.which)return that.$selectionUl.focus(),!1})},afterSelect:function(){this.qs1.cache(),this.qs2.cache()},afterDeselect:function(){this.qs1.cache(),this.qs2.cache()}}),$(".single-selection").multiselect({enableFiltering:!0,enableCaseInsensitiveFiltering:!0,templates:{}}),$(".summernote").summernote({placeholder:"Project description",height:300,callbacks:{onChange:function(contents,$editable){console.log("onChange:",contents,$editable)}}}),$(".project-deadline").datepicker({format:" mm/dd/yyyy",startDate:"0d"});let miles=[];function Mile(){this.mile_name="",this.mile_description="",this.mile_day="",this.mile_perpay=0,this.mile_content=""}let mile_pattern=`<div class="mile-properties">${$(".mile-properties")[0].innerHTML}</div>`,mile_change_handle=function(){$(".data-change-handle").change(function(){var id=$(this).parents(".mile-properties").attr("id"),attr=this.getAttribute("data-name"),value=this.value;miles[id][attr]=value,_miles=Object.keys(miles).map(e=>miles[e]),document.querySelector("input[name=milestones]").value=JSON.stringify(_miles)}),$(".data-change-handle").keyup(function(){var id=$(this).parents(".mile-properties").attr("id"),attr=this.getAttribute("data-name"),value=this.value;miles[id][attr]=value,_miles=Object.keys(miles).map(e=>miles[e]),document.querySelector("input[name=milestones]").value=JSON.stringify(_miles)})},mile_remove_handle=function(){$(".mile-trash").on("click",function(){if(Object.keys(miles).length>1){var that=$(this).parents(".mile-properties"),id=that.attr("id");delete miles[id],that.remove(),_miles=Object.keys(miles).map(e=>miles[e]),document.querySelector("input[name=milestones]").value=JSON.stringify(_miles)}})},mile_show_form=function(parent=null){parent?($(parent).find("input[data-name=mile_name]").attr("readonly",!1),$(parent).children(".mile-des").removeClass("d-none"),$(parent).children(".mile-perpay").removeClass("d-none"),$(parent).children(".mile-content").removeClass("d-none"),$(parent).children(".mile-time").removeClass("d-none"),$(parent).children(".mile-show").addClass("d-none"),$(parent).children(".mile-hide").removeClass("d-none")):($("input[data-name=mile_name]").attr("readonly",!1),$(".mile-des").removeClass("d-none"),$(".mile-perpay").removeClass("d-none"),$(".mile-content").removeClass("d-none"),$(".mile-time").removeClass("d-none"),$(".mile-show").addClass("d-none"))},mile_hide_form=function(){$("input[data-name=mile_name]").attr("readonly",!0),$(".mile-des").addClass("d-none"),$(".mile-perpay").addClass("d-none"),$(".mile-content").addClass("d-none"),$(".mile-time").addClass("d-none"),$(".mile-hide").addClass("d-none"),$(".mile-show").removeClass("d-none")},mile_add_form=function(){mile_hide_form();let ele=html_parser(mile_pattern);var id=gen_id();ele.querySelector(".mile-properties").setAttribute("id",id),miles[id]=new Mile;var pattern=ele.querySelector("body").innerHTML;$(".mile").append(pattern),mile_change_handle()},mile_show_form_action=function(){$(".mile-show").on("click",function(){mile_hide_form(),mile_show_form($(this).parent())})},mile_hide_form_action=function(){$(".mile-hide").on("click",function(){mile_hide_form()})};$(".mile-add").on("click",function(){mile_hide_form(),mile_add_form(),mile_show_form_action(),mile_hide_form_action(),mile_change_handle(),mile_remove_handle()});var _id=gen_id();document.querySelector(".mile-properties").setAttribute("id",_id),miles[_id]=new Mile,mile_show_form_action(),mile_hide_form_action(),mile_change_handle(),mile_remove_handle();let add_default_option=function(object){var option=document.createElement("option");option.text="None",option.setAttribute("selected",!0),object.options.add(option)};$("select[name=address_country]").change(function(){var data={_country:this.value},state_link=document.querySelector("input[name=state_link").value,that=this.parentElement.parentElement.nextElementSibling.querySelector("select"),that_that=this.parentElement.parentElement.nextElementSibling.nextElementSibling.querySelector("select");that.city=that_that,get_data(data,state_link,"POST",that,function(object,data){console.log(data),object.innerHTML="",add_default_option(object),data.states.forEach(function(e){var option=document.createElement("option");option.text=e.state,option.value=e.id,object.options.add(option)}),object.city.options.length=0,add_default_option(object.city),data.cities.forEach(function(e){var option=document.createElement("option");option.text=e.city,option.value=e.id,object.city.options.add(option)}),$(".single-selection").multiselect("rebuild")})}),$("select[name=address_state]").change(function(){var country=document.querySelector("select[name=address_country]").value,data={_state:this.value,_country:country},state_link=document.querySelector("input[name=city_link").value,that=this.parentElement.parentElement.nextElementSibling.querySelector("select");get_data(data,state_link,"POST",that,function(object,data){object.innerHTML="",add_default_option(object),data.cities.forEach(function(e){var option=document.createElement("option");option.text=e.city,option.value=e.id,object.options.add(option)}),$(".single-selection").multiselect("rebuild")})});let questions=[];function Question(){this.question="",this.option_a="",this.option_b="",this.option_c="",this.option_d="",this.correct_option=""}let question_pattern=`<div class="_question">${$("._question")[0].innerHTML}</div>`,question_change_handle=function(){$(".question-change-hanlde").change(function(){var id=$(this).parents("._question").attr("id"),attr=this.getAttribute("data-name"),value=this.value;questions[id][attr]=value,_questions=Object.keys(questions).map(e=>questions[e]),document.querySelector("input[name=questions]").value=JSON.stringify(_questions)}),$(".question-change-hanlde").keyup(function(){var id=$(this).parents("._question").attr("id"),attr=this.getAttribute("data-name"),value=this.value;questions[id][attr]=value,_questions=Object.keys(questions).map(e=>questions[e]),document.querySelector("input[name=questions]").value=JSON.stringify(_questions)})},question_remove_handle=function(){$(".question-trash").on("click",function(){if(Object.keys(questions).length>1){var that=$(this).parents("._question"),id=that.attr("id");delete questions[id],that.remove(),_questions=Object.keys(questions).map(e=>questions[e]),document.querySelector("input[name=questions]").value=JSON.stringify(_questions)}})},question_show_form=function(parent=null){parent?($(parent).find("textarea[data-name=question]").attr("readonly",!1),$(parent).children(".options").removeClass("d-none"),$(parent).children(".question-hide").removeClass("d-none"),$(parent).children(".question-show").addClass("d-none")):question_hide_form()},question_hide_form=function(){$("textarea[data-name=question]").attr("readonly",!0),$(".options").addClass("d-none"),$(".question-hide").addClass("d-none"),$(".question-show").removeClass("d-none")},question_add_form=function(){question_hide_form();let ele=html_parser(question_pattern);var id=gen_id();ele.querySelector("._question").setAttribute("id",id),questions[id]=new Question;var pattern=ele.querySelector("body").innerHTML;$("._questions").append(pattern),question_change_handle()},question_show_form_action=function(){$(".question-show").on("click",function(){question_hide_form(),question_show_form($(this).parent())})},question_hide_form_action=function(){$(".question-hide").on("click",function(){question_hide_form()})};$(".question-add").on("click",function(){question_hide_form(),question_add_form(),question_show_form_action(),question_hide_form_action(),question_change_handle(),question_remove_handle()});var _id=gen_id();document.querySelector("._question").setAttribute("id",_id),questions[_id]=new Question,question_show_form_action(),question_hide_form_action(),question_change_handle(),question_remove_handle(),file_click_event_init();let gen_file_selected=function(){$(".file-attached").html("");var _files=$("input[name=file_attached]").val();JSON.parse(_files).forEach(function(e){var text=$(`.image-contain a[data-id=${e}]`).find(".file-name p").text();$(".file-attached").append(`\n  <div class="alert alert-success alert-dismissible" role="alert" data-file-name="${text}"><i class="fas fa-file"></i> ${text}</div>\n  `)})};$("#largeModal").on("hidden.bs.modal",gen_file_selected);let metas={};$("input[types=meta]").on("change",function(){metas[this.getAttribute("key")]=this.value,document.querySelector("input[name=metas]").value=JSON.stringify(metas)});var files,files=(files=$("input[name=file_attached]").val())?JSON.parse(files):[];$(".image-contain").each(function(){files.includes($(this).find("a").attr("data-id"))&&$(this).addClass("highlight-select")}),gen_file_selected()});let file_click_event_init=function(){$(".file-select").on("click",image_click_event)},image_click_event=function(){var data=[];$(this).parent().toggleClass("highlight-select"),$(".image-contain.highlight-select").each(function(){data.push($(this).find("a").attr("data-id"))}),$("input[name=file_attached]").val(JSON.stringify(data))},drop_sync=function(n=1,_represents=null,_cover=null){_represents=_represents||{pdf:'<div class="icon"><i class="fas fa-file-pdf text-danger"></i></div>',doc:'<div class="icon"><i class="fas fa-file-word"></i></div>',docx:'<div class="icon"><i class="fas fa-file-word"></i></div>',xls:'<div class="icon"><i class="fas fa-chart-bar text-warning"></i></div>',xlsx:'<div class="icon"><i class="fas fa-chart-bar text-warning"></i></div>',png:'<div class="image"><img src="[imagesource]" alt="img" class="img-fluid"/></div>',jpeg:'<div class="image"><img src="[imagesource]" alt="img" class="img-fluid"/></div>',jpg:'<div class="image"><img src="[imagesource]" alt="img" class="img-fluid"/></div>'},_cover=_cover||'<div class="col-lg-2 col-md-3 col-sm-12 pl-1 pr-1">\n                  <div class="card file_manager">\n                    <div class="file m-1 image-contain highlight-select">\n                      <a href="javascript:void(0);" data-id="[fileid]" class="file-select">\n                        [filerep]\n                        <div class="file-name">\n                          <p class="m-b-5 text-muted">[filename]</p>\n                          <small>[filesize] mb <span class="date text-muted">[filetime]</span></small>\n                        </div>\n                      </a>\n                    </div>\n                  </div>\n                </div>',Dropzone.options.myDropzone={paramName:"file",maxFilesize:20,maxFiles:n,acceptedFiles:".jpeg,.jpg,.png,.pdf,.doc,.docx,.xls,.xlsx,.csv,.mp4",init:function(){that=this,this.on("success",function(file,response){if("success"==response.status){var data=response.info;console.log(data),__cover=_cover,__cover=__cover.replace(/\[filerep\]/,_represents[data.extension].replace(/\[imagesource\]/,data.url)),__cover=__cover.replace(/\[fileid\]/,data.id),__cover=__cover.replace(/\[filename\]/,data.name),__cover=__cover.replace(/\[filesize\]/,data.size),__cover=__cover.replace(/\[filetime\]/,data.time),$(".media-container").append(__cover),$(".file-select").last().on("click",image_click_event),$(".image-contain.highlight-select").each(function(){data.push($(this).find("a").attr("data-id"))})}})}}};drop_sync(20);